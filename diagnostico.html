<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OrderFlow - Diagnóstico Inteligente</title>
    <link rel="stylesheet" href="css/style.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Open+Sans:wght@400;600;700&display=swap"
        rel="stylesheet">
    <link rel="icon" type="image/png" href="faviconorderflow.png">
    <style>
        /* Base page style overrides for premium feel */
        body {
            background-color: #0b1015;
            background-image: radial-gradient(circle at 50% 0%, #1c2a38 0%, #0b1015 60%);
            min-height: 100vh;
        }

        .hero {
            position: relative;
            z-index: 10;
        }

        .diagnostic-card {
            background: rgba(30, 36, 44, 0.6);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 24px;
            padding: 50px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            max-width: 800px;
            margin: 0 auto;
            animation: fadeInUp 0.5s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .progress-container {
            margin-bottom: 40px;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            width: 100%;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #47a2e8, #00d2ff);
            width: 0%;
            transition: width 0.6s cubic-bezier(0.22, 1, 0.36, 1);
            box-shadow: 0 0 10px rgba(71, 162, 232, 0.5);
        }

        .question-container {
            min-height: 350px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }

        .question-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #fff;
            margin-bottom: 15px;
            font-family: 'Inter', sans-serif;
            letter-spacing: -0.02em;
        }

        .question-subtitle {
            color: #b0bec5;
            margin-bottom: 30px;
            font-size: 1.05rem;
            line-height: 1.5;
        }

        /* Option Buttons */
        .option-btn {
            display: flex;
            align-items: center;
            width: 100%;
            padding: 18px 24px;
            margin-bottom: 15px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: #e0e0e0;
            font-size: 1.1rem;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
        }

        .option-btn:hover {
            border-color: #47a2e8;
            background: rgba(255, 255, 255, 0.06);
            transform: translateX(4px);
        }

        .option-btn.selected {
            border-color: #47a2e8;
            background: rgba(71, 162, 232, 0.15);
            color: #fff;
            font-weight: 600;
            box-shadow: 0 0 15px rgba(71, 162, 232, 0.1);
        }

        /* Inputs */
        .text-input,
        .textarea-input {
            width: 100%;
            padding: 18px;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: #fff;
            font-size: 1.05rem;
            margin-top: 15px;
            font-family: 'Inter', sans-serif;
            box-sizing: border-box;
            transition: border-color 0.3s, background 0.3s;
        }

        .textarea-input {
            min-height: 120px;
            resize: vertical;
            line-height: 1.6;
        }

        .text-input:focus,
        .textarea-input:focus {
            outline: none;
            border-color: #47a2e8;
            background: rgba(0, 0, 0, 0.3);
            box-shadow: 0 0 0 4px rgba(71, 162, 232, 0.1);
        }

        .text-input::placeholder,
        .textarea-input::placeholder {
            color: rgba(255, 255, 255, 0.3);
        }

        /* Navigation Buttons */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 50px;
            gap: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            padding-top: 30px;
        }

        .nav-btn {
            padding: 14px 32px;
            border-radius: 50px;
            font-size: 1.05rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
            border: none;
        }

        .nav-btn.back {
            background: transparent;
            color: #8899a6;
            padding-left: 0;
        }

        .nav-btn.back:hover {
            color: #fff;
            transform: translateX(-4px);
        }

        .nav-btn.next {
            background: linear-gradient(135deg, #47a2e8 0%, #0078d4 100%);
            color: #fff;
            box-shadow: 0 4px 15px rgba(71, 162, 232, 0.3);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-btn.next:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(71, 162, 232, 0.4);
        }

        .section-label {
            color: #47a2e8;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        /* Contact Fields */
        .contact-field {
            margin-bottom: 25px;
        }

        .contact-field label {
            display: block;
            margin-bottom: 10px;
            color: #ccc;
            font-weight: 500;
            font-size: 0.95rem;
        }

        .contact-field input {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 16px;
            border-radius: 12px;
            color: white;
            width: 100%;
            font-size: 1rem;
        }

        .contact-field input:focus {
            border-color: #47a2e8;
            outline: none;
            box-shadow: 0 0 0 4px rgba(71, 162, 232, 0.1);
        }

        .submit-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #0078d4 0%, #00c6eb 100%);
            border: none;
            border-radius: 60px;
            color: #fff;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(0, 120, 212, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(0, 120, 212, 0.5);
        }

        .privacy-note {
            background: rgba(71, 162, 232, 0.08);
            border: 1px solid rgba(71, 162, 232, 0.2);
            color: #a0c4e8;
            border-radius: 12px;
            margin-bottom: 30px;
        }

        /* Loading Spinner */
        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-left-color: #47a2e8;
            width: 50px;
            height: 50px;
        }
    </style>
</head>

<body>
    <header>
        <div class="logo" style="font-family: 'Inter', sans-serif;">OrderFlow</div>
        <input type="checkbox" id="menu-toggle" style="display:none;">
        <label for="menu-toggle" class="menu-icon"><span></span><span></span><span></span></label>
        <nav>
            <a href="index.html" style="font-family: 'Inter', sans-serif;">Inicio</a>
            <a href="sobre-nosotros.html" style="font-family: 'Inter', sans-serif;">Sobre Nosotros</a>
            <a href="servicios.html" style="font-family: 'Inter', sans-serif;">Servicios</a>
            <a href="analisis-negocio.html" class="nav-cta active"
                style="font-family: 'Inter', sans-serif;">Diagnóstico</a>
            <a href="contacto.html" style="font-family: 'Inter', sans-serif;">Contacto</a>
        </nav>
    </header>

    <main>
        <section class="hero" style="text-align:center; padding: 40px 20px 20px;">
            <h1
                style="font-family: 'Inter', sans-serif; margin-bottom: 15px; font-size: 2.5rem; background: linear-gradient(135deg, white 0%, #a5b4fc 100%); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: 800;">
                Diagnóstico de Procesos
            </h1>
            <p style="max-width: 600px; margin: 0 auto; line-height: 1.6; font-size: 1.15rem; color: #b0b0b0;">
                Responde unas preguntas para detectar oportunidades de automatización.
            </p>
        </section>

        <section class="content" style="padding: 20px; padding-bottom: 80px;">
            <div class="diagnostic-card">
                <div class="progress-container">
                    <div
                        style="display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.9rem; color: #aaa;">
                        <span>Progreso</span>
                        <span id="progress-text">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                </div>
                <div id="diagnostic-container" class="question-container">
                    <div style="text-align: center; color: #888;">
                        <div class="loading-spinner"></div>
                        <p style="margin-top: 20px;">Iniciando diagnóstico...</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer
        style="background:#000; color:white; text-align:center; padding:20px; margin-top:40px; width:100%; position:static;">
        <p style="margin:0;">© 2025 OrderFlow. Todos los derechos reservados.</p>
    </footer>

    <style>
        .menu-icon {
            display: none;
            flex-direction: column;
            cursor: pointer;
            width: 32px;
            height: 32px;
            justify-content: center;
            align-items: center;
            margin-left: 20px;
            z-index: 101;
        }

        .menu-icon span {
            height: 4px;
            width: 28px;
            background: white;
            margin: 4px 0;
            border-radius: 2px;
            display: block;
            transition: 0.3s;
        }

        @media (max-width: 700px) {
            nav {
                position: absolute;
                top: 60px;
                left: 0;
                width: 100vw;
                background: #000;
                flex-direction: column;
                align-items: flex-start;
                padding: 20px 0 10px 30px;
                display: none;
                z-index: 100;
            }

            header {
                flex-direction: row;
                padding: 15px 20px;
            }

            .menu-icon {
                display: flex;
            }

            #menu-toggle:checked+.menu-icon+nav {
                display: flex;
            }

            nav a {
                margin: 10px 0;
                padding: 10px 0;
                width: 100%;
                border-radius: 0;
            }
        }

        nav a.nav-cta {
            background: #47a2e8;
            color: white !important;
            border: 1px solid #47a2e8;
            border-radius: 8px;
            padding: 8px 20px !important;
            font-weight: 500;
            margin-left: 30px;
            box-shadow: 0 0 15px rgba(71, 162, 232, 0.8), 0 4px 14px rgba(71, 162, 232, 0.4);
            transition: all 0.3s ease;
            display: inline-block;
        }

        nav a.nav-cta:hover {
            background: #0078d4;
            border-color: #0078d4;
            transform: translateY(-2px);
            box-shadow: 0 0 25px rgba(71, 162, 232, 1), 0 6px 20px rgba(0, 120, 212, 0.6);
            text-decoration: none;
        }

        @media (max-width: 700px) {
            nav a.nav-cta {
                margin-left: 0;
                margin-top: 10px;
                width: fit-content;
            }
        }
    </style>

    <script>
        // =============================================
        // DIAGNOSTIC FLOW SYSTEM - SIMPLIFIED VERSION
        // =============================================

        let currentStep = 0;
        let answers = {};
        const questionFlow = [
            'tipo_negocio',
            'ventas',
            'marketing',
            'operaciones',
            'administracion',
            'pregunta_final',
            'datos_contacto'
        ];

        const container = document.getElementById('diagnostic-container');
        const progressFill = document.getElementById('progress-fill');
        const progressText = document.getElementById('progress-text');

        const QUESTIONS_CONFIG = {
            tipo_negocio: {
                label: '1. Tipo de negocio',
                title: '¿Qué tipo de negocio tienes?',
                type: 'options',
                opts: ['Restaurante / Hostelería', 'E-commerce', 'Servicios profesionales (clínicas, peluquerías, agencias…)', 'Otro / Modelo diferente'],
                otherPlaceholder: 'Especifica tu modelo de negocio...'
            },
            ventas: {
                label: '2. Ventas',
                title: 'Háblanos de tus ventas y captación',
                type: 'multi-textarea',
                questions: [
                    { id: 'v_captacion', title: '¿Cómo llegan normalmente los clientes o pedidos a tu negocio?', placeholder: 'Describe tus canales de entrada...' },
                    { id: 'v_proceso', title: '¿Qué ocurre desde que un cliente muestra interés hasta que compra o recibe el servicio?', placeholder: 'Describe el proceso paso a paso...' },
                    { id: 'v_problemas', title: '¿Qué problemas o dificultades ocurren durante este proceso?', placeholder: 'Menciona los obstáculos principales...' }
                ]
            },
            marketing: {
                label: '3. Marketing',
                title: 'Háblanos de tu marketing y visibilidad',
                type: 'multi-textarea',
                questions: [
                    { id: 'm_canales', title: '¿Cómo das a conocer tu negocio a posibles clientes?', placeholder: 'Describe tus acciones para atraer visibilidad...' },
                    { id: 'm_atraccion', title: '¿Qué ocurre cuando intentas atraer o mantener clientes?', placeholder: 'Explica cómo gestionas la captación...' },
                    { id: 'm_dificultades', title: '¿Qué dificultades o inconvenientes sueles encontrar?', placeholder: 'Describe qué es lo que más te cuesta...' }
                ]
            },
            operaciones: {
                label: '4. Operaciones / Fulfillment',
                title: 'Háblanos de tus operaciones y entrega',
                type: 'multi-textarea',
                questions: [
                    { id: 'o_entrega', title: '¿Cómo se realizan las operaciones o la entrega de productos o servicios?', placeholder: 'Explica el funcionamiento interno...' },
                    { id: 'o_incidencias', title: '¿Qué problemas, retrasos o incidencias ocurren con frecuencia?', placeholder: 'Menciona los fallos más comunes...' },
                    { id: 'o_repetitivo', title: '¿Qué tareas o pasos son repetitivos o complicados?', placeholder: 'Identifica las tareas que roban tiempo...' }
                ]
            },
            administracion: {
                label: '5. Administración / Gestión interna',
                title: 'Háblanos de tu gestión interna',
                type: 'multi-textarea',
                questions: [
                    { id: 'a_control', title: '¿Cómo gestionas la información y control interno de tu negocio?', placeholder: 'Hojas de cálculo, software, manual...' },
                    { id: 'a_errores', title: '¿Qué dificultades o errores ocurren frecuentemente en la gestión interna?', placeholder: 'Errores en datos, facturación, coordinación...' },
                    { id: 'a_complicaciones', title: '¿Qué aspectos internos te generan más complicaciones o pérdidas de tiempo?', placeholder: '¿Qué es lo que más te gustaría simplificar?' }
                ]
            },
            pregunta_final: {
                label: '6. Pregunta Final',
                title: '¿Algo más que debamos saber?',
                description: 'Cualquier otra cosa que consideres importante que sepamos antes de la llamada.',
                type: 'textarea',
                id: 'final_abierta',
                placeholder: 'Tu respuesta aquí...'
            }
        };

        function updateProgress() {
            const progress = Math.round((currentStep / (questionFlow.length - 1)) * 100);
            progressFill.style.width = `${progress}%`;
            progressText.textContent = `${progress}%`;
        }

        function renderStep() {
            updateProgress();
            const stepId = questionFlow[currentStep];

            if (stepId === 'datos_contacto') {
                renderContacto();
                return;
            }

            const config = QUESTIONS_CONFIG[stepId];
            let html = `
                <p class="section-label">${config.label}</p>
                <h3 class="question-title" style="margin-bottom: 30px;">${config.title}</h3>
                ${config.description ? `<p class="question-subtitle" style="margin-top: -20px; margin-bottom: 25px; color: #aaa; font-size: 0.95rem;">${config.description}</p>` : ''}
            `;

            if (config.type === 'options') {
                html += `<div class="options-container">`;
                config.opts.forEach(opt => {
                    const selectedClass = answers[stepId] === opt ? 'selected' : '';
                    html += `<button class="option-btn ${selectedClass}" data-value="${opt}">${opt}</button>`;
                });
                html += `</div>`;

                const otherPlaceholder = config.otherPlaceholder || 'Especifica...';
                const isOtherShowing = answers[stepId] === 'Otro' || (answers[stepId] && !config.opts.includes(answers[stepId]));
                const otherValue = isOtherShowing && answers[stepId] !== 'Otro' ? answers[stepId] : '';

                html += `<input type="text" class="text-input" id="other-input" placeholder="${otherPlaceholder}" value="${otherValue}" style="${isOtherShowing ? 'display:block' : 'display:none'}; margin-top: 20px;">`;
            } else if (config.type === 'multi-textarea') {
                config.questions.forEach((q, idx) => {
                    html += `
                        <div class="question-item" style="margin-bottom: 25px; ${idx > 0 ? 'border-top: 1px solid #444; padding-top: 20px;' : ''}">
                            <h4 style="color: #eee; margin-bottom: 12px; font-size: 1rem;">${q.title}</h4>
                            <textarea class="textarea-input multi-input" data-qid="${q.id}" placeholder="${q.placeholder}" style="min-height: 80px;">${answers[q.id] || ''}</textarea>
                        </div>
                    `;
                });
            } else if (config.type === 'textarea') {
                html += `
                    <textarea class="textarea-input" id="step-input" placeholder="${config.placeholder}">${answers[config.id || stepId] || ''}</textarea>
                `;
            }

            html += `
                <div class="nav-buttons">
                    <button class="nav-btn back" id="btn-back" ${currentStep === 0 ? 'style="visibility:hidden"' : ''}>← Atrás</button>
                    <button class="nav-btn next" id="btn-next">Siguiente →</button>
                </div>
            `;

            container.innerHTML = html;

            // Event Listeners
            if (config.type === 'options') {
                const otherInput = document.getElementById('other-input');
                document.querySelectorAll('.option-btn').forEach(btn => {
                    btn.onclick = () => {
                        document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
                        btn.classList.add('selected');
                        const val = btn.dataset.value;
                        if (val.includes('Otro')) {
                            otherInput.style.display = 'block';
                            otherInput.focus();
                            answers[stepId] = otherInput.value.trim();
                        } else {
                            otherInput.style.display = 'none';
                            answers[stepId] = val;
                        }
                    };
                });
                otherInput.oninput = () => { answers[stepId] = otherInput.value.trim(); };
            }

            document.getElementById('btn-back').onclick = () => {
                if (currentStep > 0) {
                    currentStep--;
                    renderStep();
                }
            };

            document.getElementById('btn-next').onclick = () => {
                if (config.type === 'multi-textarea') {
                    document.querySelectorAll('.multi-input').forEach(ta => {
                        answers[ta.dataset.qid] = ta.value.trim();
                    });
                } else if (config.type === 'textarea') {
                    const sid = config.id || stepId;
                    answers[sid] = document.getElementById('step-input').value.trim();
                }
                currentStep++;
                renderStep();
            };
        }

        function renderContacto() {
            updateProgress();
            container.innerHTML = `
                <p class="section-label">7. Datos de contacto</p>
                <h3 class="question-title">¡Último paso! Déjanos tus datos de contacto</h3>
                <div class="privacy-note">Usaremos estos datos solo para enviarte el análisis y coordinar la llamada.</div>
                <div class="contact-field">
                    <label>Nombre completo *</label>
                    <input type="text" id="c-nombre" placeholder="Tu nombre completo" required value="${answers.nombre || ''}">
                </div>
                <div class="contact-field">
                    <label>Email corporativo *</label>
                    <input type="email" id="c-email" placeholder="email@empresa.com" required value="${answers.email || ''}">
                </div>
                <div class="contact-field">
                    <label>Teléfono *</label>
                    <input type="tel" id="c-telefono" placeholder="600 000 000" required value="${answers.telefono || ''}">
                </div>
                <div class="nav-buttons">
                    <button class="nav-btn back" id="btn-back">← Atrás</button>
                    <button class="submit-btn" id="btn-submit" style="flex:1;">Enviar diagnóstico</button>
                </div>
            `;
            document.getElementById('btn-back').onclick = () => {
                currentStep--;
                renderStep();
            };
            document.getElementById('btn-submit').onclick = submitDiagnostic;
        }

        async function submitDiagnostic() {
            const nombre = document.getElementById('c-nombre').value.trim();
            const email = document.getElementById('c-email').value.trim();
            const telefono = document.getElementById('c-telefono').value.trim();

            if (!nombre || !email || !telefono) {
                alert('Por favor, completa todos los campos obligatorios');
                return;
            }

            answers.nombre = nombre;
            answers.email = email;
            answers.telefono = telefono;

            const submitBtn = document.getElementById('btn-submit');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Enviando...';

            const data = {
                ...answers,
                fecha: new Date().toISOString(),
                source: 'formulario_diagnostico_vbloques'
            };

            try {
                const response = await fetch('http://localhost:5678/webhook/diagnostico', {
                    method: 'POST',
                    mode: 'cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    progressFill.style.width = '100%';
                    progressText.textContent = '100%';
                    window.location.href = 'confirmacion-diagnostico.html';
                } else {
                    throw new Error('Error en el servidor');
                }
            } catch (error) {
                console.error('Error:', error);
                submitBtn.disabled = false;
                submitBtn.textContent = 'Enviar diagnóstico';
                alert('Error al enviar. Inténtalo de nuevo.');
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => { renderStep(); });
    </script>
    <script>
        window.CHATBOT_ENDPOINT = "http://localhost:5678/webhook/3381e020-7a56-4240-a876-1a837682a5eb";
    </script>
    <script src="./chat-widget.js"></script>
</body>

</html>