<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OrderFlow - Contacto</title>
  <link rel="stylesheet" href="css/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
  <link rel="icon" type="image/png" href="faviconorderflow.png">
</head>

<body>
  <header>
    <div class="logo" style="font-family: 'Playfair Display', serif;">OrderFlow</div>
    <input type="checkbox" id="menu-toggle" style="display:none;">
    <label for="menu-toggle" class="menu-icon">
      <span></span>
      <span></span>
      <span></span>
    </label>
    <nav>
      <a href="index.html" style="font-family: 'Playfair Display', serif;">Inicio</a>
      <a href="sobre-nosotros.html" style="font-family: 'Playfair Display', serif;">Sobre Nosotros</a>
      <a href="servicios.html" style="font-family: 'Playfair Display', serif;">Servicios</a>
      <a href="analisis-negocio.html" class="nav-cta" style="font-family: 'Playfair Display', serif;">Solicitar
        Diagnóstico</a>
      <a href="contacto.html" class="active" style="font-family: 'Playfair Display', serif;">Contacto</a>
    </nav>
  </header>

  <main>
    <section class="content">
      <h1 style="font-family: 'Playfair Display', serif; margin-bottom:32px;">Contacto</h1>
      <p style="max-width:600px; margin:20px auto; padding:0 5%; line-height:1.6; margin-bottom:24px;">Rellena el
        formulario y nos pondremos en contacto contigo.</p>

      <div
        style="max-width: 550px; margin: 0 auto; background: #313131; padding: 40px; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
        <form id="contact-form" style="max-width: 100%; gap: 20px;">
          <div style="display: flex; flex-direction: column; gap: 8px;">
            <label style="font-weight: 600; color: #fff;">Nombre Completo *</label>
            <input id="nombre" name="nombre" placeholder="Tu nombre" required
              style="padding: 12px; border-radius: 8px; border: 1px solid #444; background: #222; color: #fff;">
          </div>

          <div style="display: flex; flex-direction: column; gap: 8px;">
            <label style="font-weight: 600; color: #fff;">Sector *</label>
            <input id="negocio" name="negocio" placeholder="Ej: Clínica" required
              style="padding: 12px; border-radius: 8px; border: 1px solid #444; background: #222; color: #fff;">
          </div>

          <div style="display: flex; flex-direction: column; gap: 8px;">
            <label style="font-weight: 600; color: #fff;">Email corporativo *</label>
            <input id="email" name="email" type="email" placeholder="email@empresa.com" required
              style="padding: 12px; border-radius: 8px; border: 1px solid #444; background: #222; color: #fff;">
          </div>

          <div style="display: flex; flex-direction: column; gap: 8px;">
            <label style="font-weight: 600; color: #fff;">Teléfono *</label>
            <div style="display: flex; gap: 8px; align-items: center;">
              <div style="position: relative; min-width: 110px;">
                <div id="flag-container"
                  style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); width: 22px; height: 15px; pointer-events: none; background-size: cover; background-position: center; border-radius: 1px; z-index: 1;">
                </div>
                <select id="pais" name="pais"
                  style="width: 100%; padding: 12px 8px 12px 38px; border-radius: 8px; border: 1px solid #444; background: #222; color: #fff; font-size: 1rem; appearance: none; cursor: pointer;"
                  required>
                  <option value="+34" data-format="XXX XXX XXX" data-code="es">+34</option>
                  <option value="+1" data-format="XXX XXX XXXX" data-code="us">+1</option>
                  <option value="+44" data-format="XXXX XXXXXX" data-code="gb">+44</option>
                  <option value="+33" data-format="X XX XX XX XX" data-code="fr">+33</option>
                  <option value="+49" data-format="XXX XXXXXXXX" data-code="de">+49</option>
                  <option value="+39" data-format="XXX XXX XXXX" data-code="it">+39</option>
                  <option value="+351" data-format="XXX XXX XXX" data-code="pt">+351</option>
                  <option value="+52" data-format="XX XXXX XXXX" data-code="mx">+52</option>
                  <option value="+54" data-format="XX XXXX XXXX" data-code="ar">+54</option>
                  <option value="+56" data-format="X XXXX XXXX" data-code="cl">+56</option>
                  <option value="+57" data-format="XXX XXX XXXX" data-code="co">+57</option>
                  <option value="+51" data-format="XXX XXX XXX" data-code="pe">+51</option>
                  <option value="+55" data-format="XX XXXXX XXXX" data-code="br">+55</option>
                </select>
              </div>
              <input id="telefono" name="telefono" type="tel" required
                style="flex: 1; padding: 12px; border-radius: 8px; border: 1px solid #444; background: #222; color: #fff;">
            </div>
          </div>

          <div style="display: flex; flex-direction: column; gap: 8px;">
            <label style="font-weight: 600; color: #fff;">Mensaje *</label>
            <textarea id="mensaje" name="mensaje" placeholder="Cuéntanos brevemente tu duda o en qué podemos ayudarte"
              rows="4"
              style="padding: 12px; border-radius: 8px; border: 1px solid #444; background: #222; color: #fff; resize: vertical;"
              required></textarea>
          </div>

          <button type="submit"
            style="margin-top: 10px; padding: 15px; font-weight: bold; font-size: 1.1rem; border-radius: 8px; transition: 0.3s; background: #47a2e8;">Enviar</button>
        </form>
      </div>
      <!-- Mensaje de estado (oculto por defecto) -->
      <div id="form-status" class="form-status" role="status" aria-live="polite"
        style="display:none; text-align:center; margin-top:12px; padding:10px; border-radius:6px;"></div>
      <div class="or-line"><span>O contáctanos por</span></div>
      <p class="contact-email"><a href="mailto:orderflow.team@gmail.com">orderflow.team@gmail.com</a></p>
    </section>
  </main>

  <footer
    style="background:#000; color:white; text-align:center; padding:20px; margin-top:0; position:static; left:0; bottom:0; width:100%;">
    <p style="margin:0;">© 2025 OrderFlow. Todos los derechos reservados.</p>
  </footer>
  <style>
    .menu-icon {
      display: none;
      flex-direction: column;
      cursor: pointer;
      width: 32px;
      height: 32px;
      justify-content: center;
      align-items: center;
      margin-left: 20px;
      z-index: 101;
    }

    .menu-icon span {
      height: 4px;
      width: 28px;
      background: white;
      margin: 4px 0;
      border-radius: 2px;
      display: block;
      transition: 0.3s;
    }

    @media (max-width: 600px) {
      nav {
        position: absolute;
        top: 60px;
        left: 0;
        width: 100vw;
        background: #000;
        flex-direction: column;
        align-items: flex-start;
        padding: 20px 0 10px 30px;
        display: none;
        z-index: 100;
      }

      header {
        flex-direction: row;
        padding: 15px 20px;
      }

      .menu-icon {
        display: flex;
      }

      #menu-toggle:checked+.menu-icon+nav {
        display: flex;
      }

      nav a {
        margin: 10px 0;
        padding: 10px 0;
        width: 100%;
        border-radius: 0;
      }
    }

    nav a.nav-cta {
      background: #47a2e8;
      color: white !important;
      border: 1px solid #47a2e8;
      border-radius: 8px;
      padding: 8px 20px !important;
      font-weight: bold;
      margin-left: 30px;
      box-shadow: 0 0 15px rgba(71, 162, 232, 0.8), 0 4px 14px rgba(71, 162, 232, 0.4);
      transition: all 0.3s ease;
      display: inline-block;
    }

    nav a.nav-cta:hover {
      background: #0078d4;
      border-color: #0078d4;
      transform: translateY(-2px);
      box-shadow: 0 0 25px rgba(71, 162, 232, 1), 0 6px 20px rgba(0, 120, 212, 0.6);
      text-decoration: none;
    }

    @media (max-width: 600px) {
      nav a.nav-cta {
        margin-left: 0;
        margin-top: 10px;
        text-align: center;
      }
    }

    .form-status {
      font-size: 0.95rem;
    }

    .form-status.success {
      background: #0b6623;
      color: #fff;
    }

    .form-status.error {
      background: #6b0b0b;
      color: #fff;
    }
  </style>

  <script>
    document.getElementById("contact-form").addEventListener("submit", async function (e) {
      e.preventDefault();

      const form = e.target;
      const submitBtn = form.querySelector('button[type="submit"]');

      const originalText = submitBtn.textContent; // Guardar texto original
      const originalBg = submitBtn.style.backgroundColor || '#007BFF'; // Guardar color original
      const originalColor = submitBtn.style.color || '#fff';

      const data = {
        nombre: document.getElementById("nombre").value,
        negocio: document.getElementById("negocio").value,
        email: document.getElementById("email").value,
        pais: document.getElementById("pais").value,
        telefono: document.getElementById("telefono").value,
        mensaje: document.getElementById("mensaje").value,
      };

      // Estado de envío
      submitBtn.disabled = true;
      submitBtn.textContent = 'Enviando...';
      submitBtn.style.backgroundColor = '#6c757d'; // gris para "procesando"
      submitBtn.style.color = '#fff';

      try {
        const response = await fetch("http://localhost:5678/webhook/contacto-orderflow", {
          method: "POST",
          mode: "cors",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });

        let result = {};
        try { result = await response.json(); } catch (e) { /* ignore */ }

        if (response.ok && (result.success === undefined || result.success)) {
          submitBtn.textContent = '¡Enviado!';
          submitBtn.style.backgroundColor = '#28a745'; // verde
          submitBtn.style.color = '#fff';
          form.reset();
        } else {
          submitBtn.textContent = 'Error. Intenta de nuevo';
          submitBtn.style.backgroundColor = '#dc3545'; // rojo
          submitBtn.style.color = '#fff';
          console.error('Respuesta no OK:', response.status, result);
        }

      } catch (error) {
        console.error("Error al enviar:", error);
        submitBtn.textContent = 'Error. Intenta de nuevo';
        submitBtn.style.backgroundColor = '#dc3545'; // rojo
        submitBtn.style.color = '#fff';
      } finally {
        // Volver al estado original después de 3 segundos
        setTimeout(() => {
          submitBtn.disabled = false;
          submitBtn.textContent = originalText;
          submitBtn.style.backgroundColor = originalBg;
          submitBtn.style.color = originalColor;
        }, 3000);
      }
    });

    // Lógica de formateo de teléfono
    const paisSelect = document.getElementById('pais');
    const telefonoInput = document.getElementById('telefono');

    if (paisSelect && telefonoInput) {
      const flagContainer = document.getElementById('flag-container');

      const updateFormat = () => {
        const option = paisSelect.options[paisSelect.selectedIndex];
        const format = option.getAttribute('data-format');
        const countryCode = option.getAttribute('data-code');

        // Actualizar bandera
        if (flagContainer && countryCode) {
          flagContainer.style.backgroundImage = `url('https://flagcdn.com/w40/${countryCode}.png')`;
        }

        telefonoInput.placeholder = format;
        telefonoInput.value = ''; // Limpiar al cambiar
      };

      const formatPhone = (e) => {
        if (e.inputType === 'deleteContentBackward') return;

        const format = paisSelect.options[paisSelect.selectedIndex].getAttribute('data-format');
        let value = telefonoInput.value.replace(/\D/g, '');
        let formattedValue = '';
        let valueIndex = 0;

        for (let i = 0; i < format.length && valueIndex < value.length; i++) {
          if (format[i] === 'X') {
            formattedValue += value[valueIndex];
            valueIndex++;
          } else {
            formattedValue += format[i];
          }
        }
        telefonoInput.value = formattedValue;
      };

      telefonoInput.addEventListener('input', formatPhone);
      paisSelect.addEventListener('change', updateFormat);

      // Inicializar el placeholder al cargar
      updateFormat();
    }
  </script>
  <script>
    window.CHATBOT_ENDPOINT = "https://orderflowagency.app.n8n.cloud/webhook/bf6397e7-fac0-471c-9572-7666849750b2";
  </script>

  <script src="./chat-widget.js"></script>

</body>

</html>